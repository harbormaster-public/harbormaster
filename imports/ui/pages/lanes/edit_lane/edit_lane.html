<template name="edit_lane">
  <h1>Edit Lane:</h1>
  {{#if plying}}
    <form>
      <label>Lane Name
        <input type=text required class="lane-name" value={{lane_name}}>
      </label>
      <button class="button hollow secondary back-to-lanes">Back to Lanes</button>
      {{#unless validate_done}}
        <a href=/lanes/{{lane_name}}/ship class="button success ship-lane hollow">Ship to this Lane</a>
      {{else}}
        <button disabled class="button hollow alert lane-done">Not Ready</button>
      {{/unless}}
      <fieldset class="fieldset captains">
        <legend>Captain(s)</legend>
        <ul>
          {{#each captain_list}}
          <li>
            <label>
              <input type=checkbox checked={{can_ply}} disabled={{can_set_ply}} value={{_id}}>
              {{_id}}
            </label>
          </li>
          {{/each}}
        </ul>
      </fieldset>
      <h2>Harbor</h2>
      <fieldset class="fieldset harbor">
        {{#unless current_lane.type}}
          {{#if choose_type}}
            <legend>Choose your type of Work:</legend>
            {{#each harbors}}
            <button id=button-choose-{{_id}} class="button choose-harbor-type" data-type={{_id}}>{{_id}}</button>
            {{/each}}
          {{else}}
            <button class="button add-harbor"><h3>Add some Work for this Harbor <span>+</span></h3></button>
          {{/if}}
        {{/unless}}
        {{#if current_lane.type}}
          <legend>Work: {{lane_type}}</legend>
          <section>
            {{{render_harbor}}}
          </section>
        {{/if}}
      </fieldset>
      {{#unless no_followup}}
        <button class="button tiny add-followup">Add Followup Destination</button>
      {{/unless}}
      {{#unless no_salvage}}
        <button class="button tiny warning add-salvage-plan">Add a Salvage Plan</button>
      {{/unless}}

      {{#if choose_followup}}
      <fieldset class="fieldset followup">
        <legend>Followup: {{followup_lane}}</legend>
        {{#each lanes}}
          <label>
            <input checked={{chosen_lane}} type=radio name="lanes" value={{_id}}>
            {{name}}
          </label>
        {{/each}}
      </fieldset>
      {{/if}}
    </form>
  {{/if}}
  <h2>Shipping Log: Last {{shipping_log_amount_shown}} shipments</h2>
  <ul>
    {{#if lane}}
      {{#if lane.shipment_active}}
        <li><a href="/lanes/{{lane.name}}/ship/{{lane.latest_shipment}}" class="button tiny warning">Shipment currently in progress...</a></li>
      {{/if}}
    {{/if}}
    {{#each lane "history"}}
      {{#if this.salvaged}}
        <li>
          <a href="/lanes/{{lane.name}}/ship/{{this.manifest.shipment_start_date}}" class="button tiny alert hollow">
            Salvaged on {{pretty_date this.finished}}, {{duration}} duration
          </a>
        </li>
      {{else}}
        <li>
          <a href="/lanes/{{lane.name}}/ship/{{this.manifest.shipment_start_date}}" class="button tiny hollow">
            Shipped on {{pretty_date this.actual}}, finished on {{pretty_date this.finished}}, {{duration}} duration
          </a>
        </li>
      {{/if}}
    {{/each}}
  </ul>
</template>
